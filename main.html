<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trailblazer â€” Daily Puzzle</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Inter', system-ui, sans-serif;
    display: flex; justify-content: center; align-items: center;
    height: 100vh; margin: 0; background: #f8f9fa;
  }
  .game {
    max-width: 95vw; text-align: center;
  }
  h1 { font-weight: 600; margin-bottom: 0.25em; }
  #board {
    display: grid; gap: 2px; margin: 1em auto;
    background: #ccc; padding: 2px; border-radius: 8px;
    user-select: none; touch-action: manipulation;
  }
  .tile {
    width: 40px; height: 40px;
    display: flex; justify-content: center; align-items: center;
    font-size: 0.8em; border-radius: 6px;
    transition: transform 0.15s, background 0.3s;
  }
  .tile:hover { transform: scale(1.05); cursor: pointer; }
  canvas {
    position: absolute; top: 0; left: 0; pointer-events: none;
  }
  .hud { font-size: 0.9em; margin: 0.5em 0; }
  button {
    margin: 0.25em; padding: 0.5em 1em;
    border: none; border-radius: 6px;
    background: #222; color: white; font-weight: 600;
    cursor: pointer; transition: background 0.3s;
  }
  button:hover { background: #444; }
  #message { font-weight: 600; margin: 0.5em; }
</style>
</head>
<body>
<div class="game">
  <h1>Trailblazer</h1>
  <div class="hud">
    <span>Difficulty:
      <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="medium" selected>Medium</option>
        <option value="hard">Hard</option>
      </select>
    </span>
    <span style="margin-left:1em;">Par: <span id="par">0</span></span>
    <span style="margin-left:1em;">Color changes: <span id="changes">0</span></span>
    <span style="margin-left:1em;">Time: <span id="time">0.0</span>s</span>
  </div>
  <div id="board"></div>
  <canvas id="pathCanvas"></canvas>
  <div>
    <button id="restart">Restart</button>
    <button id="solution" style="display:none;">Show Solution</button>
  </div>
  <div id="message"></div>
</div>

<script>
// --- Utility: Seeded RNG for deterministic puzzles ---
function mulberry32(a) {
  return function() {
    var t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  }
}
function dateSeed() {
  let d = new Date();
  let str = d.getUTCFullYear()+"-"+(d.getUTCMonth()+1)+"-"+d.getUTCDate();
  let hash=0; for(let i=0;i<str.length;i++){hash=(hash*31+str.charCodeAt(i))|0;}
  return Math.abs(hash);
}

// --- Board state ---
let rng, N, board, solutionPath, colorRegions;
let playerPath=[], visited=new Set();
let activeColor=null, lastCell=null, colorChanges=0, par=0;
let timer, t=0, running=false, gameOver=false;

// --- DOM ---
const boardDiv=document.getElementById("board");
const parDisp=document.getElementById("par");
const ccDisp=document.getElementById("changes");
const timeDisp=document.getElementById("time");
const msg=document.getElementById("message");
const restartBtn=document.getElementById("restart");
const solBtn=document.getElementById("solution");
const canvas=document.getElementById("pathCanvas");
const ctx=canvas.getContext("2d");

restartBtn.onclick=startGame;
solBtn.onclick=showSolution;
document.getElementById("difficulty").onchange=startGame;

// --- Hamiltonian path generator (DFS backtracking) ---
function generateHamiltonian(N){
  let dirs=[[1,0],[-1,0],[0,1],[0,-1]];
  let path=[], visited=Array.from({length:N},()=>Array(N).fill(false));
  function dfs(r,c){
    path.push({r,c}); visited[r][c]=true;
    if(path.length===N*N) return true;
    // shuffle directions
    dirs.sort(()=>rng()-0.5);
    for(let [dr,dc] of dirs){
      let nr=r+dr,nc=c+dc;
      if(nr>=0&&nr<N&&nc>=0&&nc<N&&!visited[nr][nc]){
        if(dfs(nr,nc)) return true;
      }
    }
    visited[r][c]=false; path.pop(); return false;
  }
  dfs(0,0);
  return path;
}

// --- Assign colors in segments ---
function assignColors(path,difficulty){
  let colors=["#FF6B6B","#4D96FF","#6BCB77","#FFD93D","#9D4EDD"];
  let segments;
  if(difficulty==="easy") segments=3;
  else if(difficulty==="medium") segments=5;
  else segments=7;
  let segLength=Math.floor(path.length/segments);
  let board=Array.from({length:N},()=>Array(N).fill(null));
  for(let i=0;i<path.length;i++){
    let seg=Math.min(Math.floor(i/segLength),segments-1);
    board[path[i].r][path[i].c]=colors[seg%colors.length];
  }
  return board;
}

// --- Setup game ---
function startGame(){
  rng=mulberry32(dateSeed()+document.getElementById("difficulty").value.charCodeAt(0));
  let day = (new Date()).getUTCDay(); // Sunday=0, Saturday=6
  let dayOfWeek = day === 0 ? 1 : day + 1; // Sunday=1, Saturday=7
  N = 4 + dayOfWeek; // Example: Sunday=5, Saturday=11
  solutionPath=generateHamiltonian(N);
  board=assignColors(solutionPath,document.getElementById("difficulty").value);
  par= countColorChanges(solutionPath, board);
  resetState();
  renderBoard();
}

function resetState(){
  playerPath=[]; visited.clear();
  activeColor=null; lastCell=null;
  colorChanges=0; ccDisp.textContent=0;
  parDisp.textContent=par;
  t=0; timeDisp.textContent="0.0"; running=false;
  gameOver=false; msg.textContent="";
  solBtn.style.display="none";
  resizeCanvas();
  drawPath();
}

function resizeCanvas(){
  let rect=boardDiv.getBoundingClientRect();
  canvas.width=rect.width; canvas.height=rect.height;
  canvas.style.left=rect.left+"px";
  canvas.style.top=rect.top+"px";
}

// --- Rendering ---
function renderBoard(){
  boardDiv.innerHTML="";
  boardDiv.style.gridTemplateColumns=`repeat(${N},1fr)`;
  for(let r=0;r<N;r++){
    for(let c=0;c<N;c++){
      let tile=document.createElement("div");
      tile.className="tile";
      tile.style.background=board[r][c];
      tile.dataset.r=r; tile.dataset.c=c;
      tile.onclick=()=>tileClick(r,c);
      boardDiv.appendChild(tile);
    }
  }
  resizeCanvas();
}

// --- Gameplay ---
function tileClick(r,c){
  if(gameOver) return;
  let cell={r,c}, key=r+","+c;
  if(playerPath.length===0){
    playerPath.push(cell); visited.add(key);
    activeColor=board[r][c]; lastCell=cell;
    startTimer();
    drawPath(); return;
  }
  if(!isAdjacent(lastCell,cell) || visited.has(key)) return;
  if(board[r][c]!==activeColor){
    colorChanges++; activeColor=board[r][c];
    ccDisp.textContent=colorChanges;
  }
  playerPath.push(cell); visited.add(key); lastCell=cell;
  drawPath();
  checkComplete();
}
function isAdjacent(a,b){return Math.abs(a.r-b.r)+Math.abs(a.c-b.c)===1;}

function drawPath(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(playerPath.length<2) return;
  let rect=boardDiv.getBoundingClientRect();
  let tileSize=rect.width/N;
  ctx.strokeStyle="black"; ctx.lineWidth=4; ctx.lineCap="round";
  ctx.beginPath();
  ctx.moveTo((playerPath[0].c+0.5)*tileSize,(playerPath[0].r+0.5)*tileSize);
  for(let i=1;i<playerPath.length;i++){
    ctx.lineTo((playerPath[i].c+0.5)*tileSize,(playerPath[i].r+0.5)*tileSize);
  }
  ctx.stroke();
}

function checkComplete(){
  if(playerPath.length===N*N){
    stopTimer();
    gameOver=true;
    if(colorChanges<=par){
      msg.textContent="ðŸŽ‰ Perfect! You solved under par.";
    } else {
      msg.textContent="âœ… Solved, but over par.";
      solBtn.style.display="inline-block";
    }
  }
}

function showSolution(){
  resetState();
  playerPath=[...solutionPath];
  for(let cell of solutionPath) visited.add(cell.r+","+cell.c);
  drawPath();
  msg.textContent="Hereâ€™s todayâ€™s solution.";
  gameOver=true;
}

// --- Timer ---
function startTimer(){
  if(running) return;
  running=true;
  timer=setInterval(()=>{t+=0.1; timeDisp.textContent=t.toFixed(1);},100);
}
function stopTimer(){
  clearInterval(timer); running=false;
}

// --- Init ---
startGame();
window.addEventListener("resize",resizeCanvas);
</script>
</body>
</html>
